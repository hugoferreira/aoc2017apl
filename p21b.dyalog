⎕IO←0
p q←↓⍉'#'=↑∘('[#.]+'⎕S'&')¨↑'[#./]+'⎕S'&'¨⊃⎕NGET'p21.txt'1
p←(⊢,⌽¨)(⊢,⊖¨)(⊢,⍉¨)p ⋄ q←⊃,/8⍴⊂q
tile←{n←⍵⍵÷⍨≢⍵ ⋄ t←0 2 1 3⍉⍺⍺⍤2⊢0 2 1 3⍉n ⍵⍵ n ⍵⍵⍴⍵ ⋄ t⍴⍨2⍴×/2↑⍴t} ⍝ ⍺⍺ on each ⍵⍵×⍵⍵ tile of ⍵
m←2=≢¨p ⋄ a2←(m⌿q)@(2⊥⍉↑,¨m⌿p)⊢0/⍨2*2*2
m←3=≢¨p ⋄ a3←(m⌿q)@(2⊥⍉↑,¨m⌿p)⊢0/⍨2*3*2
g←{⍺⊃⍨2⊥,⍵} ⋄ f←{0=2|≢⍵:a2∘g tile 2⊢⍵ ⋄ a3∘g tile 3⊢⍵}
pat←'#'=3 3⍴'.#...####'
+/,f⍣5⊢pat ⍝ part 1
+/,f⍣18⊢pat ⍝ part 2
